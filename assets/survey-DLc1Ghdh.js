import{bf as I,x as v,H as T,J as k,g as w,Q as x,a as r,_ as O,o as f,e as h,w as o,c as R,r as D,F,aj as L,b2 as B,b as Y,d as g,bg as U,i as c,j as V,n as E,bh as _}from"./index-De8-AJ5t.js";import{d as N,e as H,c as z,f as W,g as j,h as J,V as K}from"./VTextField-DbASW9Zr.js";import{r as S,g as b,a as Q,c as A,p as q,u as X}from"./index.esm2017-4DqxI0CK.js";const P=I("v-spacer","div","VSpacer"),Z=v({start:Boolean,end:Boolean,...T(),...k()},"VListItemAction"),$=w()({name:"VListItemAction",props:Z(),setup(t,e){let{slots:a}=e;return x(()=>r(t.tag,{class:["v-list-item-action",{"v-list-item-action--start":t.start,"v-list-item-action--end":t.end},t.class],style:t.style},a)),{}}}),ee={props:["selectableValues","modelValue","rules"],data(){return{selectedValues:this.modelValue}},watch:{selectedValues:function(t){this.$emit("update:modelValue",t);const e=this.$refs.input;e&&(e.value=this.selectedValues,e.validate())}}};function te(t,e,a,l,s,u){return f(),h(W,{width:"100%",ref:"input",rules:a.rules},{default:o(()=>[r(z,null,{default:o(()=>[(f(!0),R(F,null,D(a.selectableValues,i=>(f(),h(N,{key:i,title:i,value:i},{prepend:o(()=>[r($,{start:""},{default:o(()=>[r(H,{modelValue:s.selectedValues,"onUpdate:modelValue":e[0]||(e[0]=n=>s.selectedValues=n),value:i},null,8,["modelValue","value"])]),_:2},1024)]),_:2},1032,["title","value"]))),128))]),_:1})]),_:1},8,["rules"])}const M=O(ee,[["render",te]]),se=v({...T(),...j()},"VForm"),ae=w()({name:"VForm",props:se(),emits:{"update:modelValue":t=>!0,submit:t=>!0},setup(t,e){let{slots:a,emit:l}=e;const s=J(t),u=L();function i(p){p.preventDefault(),s.reset()}function n(p){const m=p,d=s.validate();m.then=d.then.bind(d),m.catch=d.catch.bind(d),m.finally=d.finally.bind(d),l("submit",m),m.defaultPrevented||d.then(C=>{var y;let{valid:G}=C;G&&((y=u.value)==null||y.submit())}),m.preventDefault()}return x(()=>{var p;return r("form",{ref:u,class:["v-form",t.class],style:t.style,novalidate:!0,onReset:i,onSubmit:n},[(p=a.default)==null?void 0:p.call(a,s)])}),B(s,u)}}),le={data(){return{loadingApps:!1,loadedApps:!1,apps:[],genreTags:["Puzzle","Platformer","Strategy","Action","Horror","Shooter","RPG","Simulation"],selectedGenreTags:[],experienceTags:["Casual","Difficult","Funny","Story Rich"],selectedExperienceTags:[],playerOptions:["Singleplayer","Multiplayer","Both"],selectedPlayerOption:"",gamesPlayedPerYear:"",gameAgeOptions:["Only recent games","Some older games","Mostly classics"],selectedGameAgeOption:"",tagSubstitutes:{Shooter:["FPS","Third-Person Shooter"],Horror:["Psychological Horror"],Funny:["Comedy"],Strategy:["Time Management"],Simulation:["Life Sim","Farming Sim","Dating Sim"]},popularityFactor:Math.pow(10,6)*.5,loading:!1}},async mounted(){},methods:{async loadApps(){this.loadingApps=!0;const t=S(b(this.$firebaseApp)),e=await Q(A(t,"data/recommendableApps"));this.apps=await e.val(),this.loadingApps=!1,this.loadedApps=!0},getAppTagCount(t,e){const a=this.tagSubstitutes[e];if(!a){const s=t.tags.find(u=>u.name===e);return s?s.count:0}let l=0;for(const s of t.tags)(s.name===e||a.includes(s.name))&&(l=Math.max(l,s.count));return l},calculateAppTagsScore(t,e,a){let l=0;for(const s of e){const u=a.includes(s),i=this.getAppTagCount(t,s);let n=100*Math.min(1,i*1.5);u||(n*=-.1),l+=n}return l},calculateAppPopularityScore(t){return Math.min(15e6,t.estimatedOwners)/this.popularityFactor},calculateAgeScoreModifier(t){return this.selectedGameAgeOption=="Only recent games"?.1+.9*(1-Math.min(1,Math.max(0,t.yearsOld-2)/12)):this.selectedGameAgeOption=="Mostly classics"?.2+.8*Math.min(1,Math.max(0,t.yearsOld-5)/20):1},calculateGamesPerYearScoreModifier(t){const e=parseInt(this.gamesPlayedPerYear),a=Math.min(1,this.getAppTagCount(t,"Casual")*2),l=Math.min(1,this.getAppTagCount(t,"Difficult")*2),s=5;return e<s?1+(1-e/s)*(a-l*.5)*.5:e>s?1+Math.min(1,(e-s)/15)*l*.5:1},calculateAppRelevancyScore(t){let e=0;e+=this.calculateAppTagsScore(t,this.genreTags,this.selectedGenreTags)*1.5,e+=this.calculateAppTagsScore(t,this.experienceTags,this.selectedExperienceTags),e+=this.calculateAppPopularityScore(t),e*=this.calculateAgeScoreModifier(t),e*=this.calculateGamesPerYearScoreModifier(t);const a=t.reviewScore/100;return e*=a*a,e},appCanBeIncluded(t){return this.selectedPlayerOption=="Singleplayer"?t.hasSingleplayer:this.selectedPlayerOption=="Multiplayer"?t.hasMultiplayer:!0},async goToResults(){await this.$router.push("/surveyresults"),window.scrollTo(0,0)},async giveRecommendations(){if(this.loadingApps)return;this.loadedApps||await this.loadApps();const t=this.apps.filter(a=>this.appCanBeIncluded(a));for(const a of t)a.relevancyScore=this.calculateAppRelevancyScore(a);t.sort((a,l)=>l.relevancyScore-a.relevancyScore);const e=[];for(let a=0;a<15&&a<t.length;a++){const l=t[a];e.push({relevancyScore:l.relevancyScore,name:l.name,description:l.description,releaseDate:l.releaseDate,storeURL:l.storeURL,headerImageURL:l.headerImageURL,reviewScore:l.reviewScore})}localStorage.setItem("recommendedApps",JSON.stringify(e))},async submitForm(t){if(this.loading||this.loadingApps)return;if(this.loading=!0,!(await t).valid){this.loading=!1;return}await Promise.all([this.giveRecommendations(),this.submitResults()]),this.goToResults(),this.loading=!1},async submitResults(){const t=S(b(this.$firebaseApp)),e=await q(A(t,"reviews")).key,a={selectedGenreTags:this.selectedGenreTags,selectedExperienceTags:this.selectedExperienceTags,selectedPlayerOption:this.selectedPlayerOption,selectedGameAgeOption:this.selectedGameAgeOption,gamesPlayedPerYear:parseInt(this.gamesPlayedPerYear),date:new Date(Date.now()).toISOString()},l={};l[`/formResults/${e}`]=a,await X(t,l)}},components:{CheckboxList:M}};function ne(t,e,a,l,s,u){const i=M;return f(),R(F,null,[r(Y,null,{default:o(()=>e[5]||(e[5]=[c("Recommendations Survey")])),_:1}),r(g,null,{default:o(()=>e[6]||(e[6]=[c(" Take this short survey, and you will receive a list of a few recommended games for you to play. ")])),_:1}),r(ae,{onSubmit:U(u.submitForm,["prevent"])},{default:o(()=>[r(g,null,{default:o(()=>e[7]||(e[7]=[c(" What genres of games are you interested in?"),V("br",null,null,-1),c(" You may select multiple answers. ")])),_:1}),r(i,{selectableValues:s.genreTags,modelValue:s.selectedGenreTags,"onUpdate:modelValue":e[0]||(e[0]=n=>s.selectedGenreTags=n),rules:[()=>s.selectedGenreTags.length>0||"Please choose an option"]},null,8,["selectableValues","modelValue","rules"]),r(g,null,{default:o(()=>e[8]||(e[8]=[c(" What sort of experience are you looking to have?"),V("br",null,null,-1),c(" You may select multiple answers. ")])),_:1}),r(i,{selectableValues:s.experienceTags,modelValue:s.selectedExperienceTags,"onUpdate:modelValue":e[1]||(e[1]=n=>s.selectedExperienceTags=n)},null,8,["selectableValues","modelValue"]),r(g,null,{default:o(()=>e[9]||(e[9]=[c(" Do you prefer a multiplayer or singleplayer experience? ")])),_:1}),r(i,{selectableValues:s.playerOptions,modelValue:s.selectedPlayerOption,"onUpdate:modelValue":e[2]||(e[2]=n=>s.selectedPlayerOption=n),rules:[()=>s.selectedPlayerOption.length>0||"Please choose an option"]},null,8,["selectableValues","modelValue","rules"]),r(g,null,{default:o(()=>e[10]||(e[10]=[c(" Roughly, how many different games do you play per year? ")])),_:1}),r(K,{modelValue:s.gamesPlayedPerYear,"onUpdate:modelValue":e[3]||(e[3]=n=>s.gamesPlayedPerYear=n),rules:[n=>!isNaN(parseInt(n))||"Please enter a valid number",n=>n>=0||"Please enter a positive number",n=>parseFloat(n)==parseInt(n)||"Please enter a whole number"],type:"number","hide-spin-buttons":""},null,8,["modelValue","rules"]),r(g,null,{default:o(()=>e[11]||(e[11]=[c(" What sort of games do you mostly play? ")])),_:1}),r(i,{selectableValues:s.gameAgeOptions,modelValue:s.selectedGameAgeOption,"onUpdate:modelValue":e[4]||(e[4]=n=>s.selectedGameAgeOption=n),rules:[()=>s.selectedGameAgeOption.length>0||"Please choose an option"]},null,8,["selectableValues","modelValue","rules"]),r(E,{class:"my-4"},{default:o(()=>[r(P),r(_,{color:"primary",size:"x-large","append-icon":"mdi-check-bold",type:"submit",loading:s.loading||s.loadingApps},{default:o(()=>e[12]||(e[12]=[c(" Submit! ")])),_:1},8,["loading"]),r(P)]),_:1})]),_:1},8,["onSubmit"])],64)}const ue=O(le,[["render",ne]]);export{ue as default};
